services:
  mcp-time-server:
    build: .
    restart: unless-stopped
    environment:
      PORT: ${PORT:-7545}
      HOST: ${HOST:-0.0.0.0}

      # Required for production
      REDIS_URL: ${REDIS_URL}
      # Auth (choose one)
      # - AUTH_MODE=env: use MCP_BEARER_TOKENS
      # - AUTH_MODE=db : use DATABASE_URL + /auth + /me/api-keys
      AUTH_MODE: ${AUTH_MODE:-env}
      MCP_BEARER_TOKENS: ${MCP_BEARER_TOKENS:-}
      DATABASE_URL: ${DATABASE_URL:-}

      # Auth & quota (db mode)
      DEFAULT_FREE_DAILY_REQUEST_LIMIT: ${DEFAULT_FREE_DAILY_REQUEST_LIMIT:-200}
      POLICY_CACHE_SECONDS: ${POLICY_CACHE_SECONDS:-60}
      AUTH_SESSION_COOKIE_NAME: ${AUTH_SESSION_COOKIE_NAME:-sid}
      AUTH_SESSION_TTL_SECONDS: ${AUTH_SESSION_TTL_SECONDS:-604800}
      AUTH_COOKIE_SECURE: ${AUTH_COOKIE_SECURE:-1}

      # Request logs
      REQUEST_LOG_RETENTION_DAYS: ${REQUEST_LOG_RETENTION_DAYS:-7}
      REQUEST_LOG_FLUSH_EVERY_MS: ${REQUEST_LOG_FLUSH_EVERY_MS:-1000}
      REQUEST_LOG_MAX_BUFFER: ${REQUEST_LOG_MAX_BUFFER:-200}

      # Limits
      MCP_BODY_LIMIT: ${MCP_BODY_LIMIT:-512kb}
      RATE_LIMIT_PER_IP_PER_MINUTE: ${RATE_LIMIT_PER_IP_PER_MINUTE:-120}
      SSE_MAX_CONNS_PER_IP: ${SSE_MAX_CONNS_PER_IP:-5}
      TRUST_PROXY_HOPS: ${TRUST_PROXY_HOPS:-1}

      # Admin dashboard (optional)
      ADMIN_USERNAME: ${ADMIN_USERNAME:-}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD:-}
      ADMIN_COOKIE_SECRET: ${ADMIN_COOKIE_SECRET:-}
      ADMIN_COOKIE_SECURE: ${ADMIN_COOKIE_SECURE:-1}
      ADMIN_SESSION_TTL_SECONDS: ${ADMIN_SESSION_TTL_SECONDS:-604800}
    ports:
      - "127.0.0.1:${PORT:-7545}:${PORT:-7545}"
