# Work Log

2026-01-04T02:47:46.480Z --- 增加账号/登录、API Key、配额与监控（Redis+PostgreSQL）--- 新增 Postgres 表结构(sql/001_init.sql)，引入 AUTH_MODE=db|env|both；实现 /auth、/me/api-keys；/mcp 按 UTC 日对 tools/call 做配额与 7 天游标；/admin 增加 DB/配额概览 --- 修改了 package.json pnpm-lock.yaml .env.example docker-compose.yml README.md src/index.ts src/admin.ts src/db.ts src/quota.ts src/mcpQuota.ts src/security.ts；新增 sql/001_init.sql src/config.ts src/auth.ts src/me.ts src/mcpAuth.ts src/requestLog.ts src/lastUsed.ts src/redisLike.ts work.md
2026-01-04T03:50:13Z --- 修复 Admin 可直接访问 Bug + 新增 Dashboard（注册/登录/Key 管理）--- 修复 admin_session 清理 Path；引入 API_KEY_ENCRYPTION_SECRET 并用 AES-256-GCM 加密存储 API Key 明文，支持 Dashboard 点击复制临时解密；新增 /dashboard 页面版注册/登录与 Key 表格 --- 修改了 src/admin.ts src/index.ts src/config.ts src/me.ts src/mcpAuth.ts sql/001_init.sql .env.example docker-compose.yml README.md work.md；新增 sql/002_api_keys_secret_enc.sql src/cryptoBox.ts src/dashboard.ts
2026-01-04T06:14:57Z --- Dashboard UI 对齐 Admin 风格 --- 抽出共享 UI（baseStyles/layoutHtml 等）到 src/ui.ts；/dashboard/login /dashboard/register /dashboard 页面复用 Admin 的 topbar/card/table 结构；Admin 同步改为 import 共享 UI，避免样式漂移 --- 修改了 src/ui.ts src/admin.ts src/dashboard.ts work.md
2026-01-04T06:28:59Z --- 隐藏 Admin 入口 + 会话 3 小时过期（绝对过期）--- Dashboard 页面移除所有 /admin 链接；防止 AUTH_SESSION_COOKIE_NAME 与 admin cookie 冲突；Admin/Dashboard 会话默认 TTL 调整为 10800 秒，并同步文档与示例 --- 修改了 src/dashboard.ts src/config.ts src/index.ts .env.example README.md work.md
2026-01-04T06:57:24Z --- 将 Admin 内容迁移到 Dashboard + Admin 改为后端管理（最小可用）--- Dashboard 增加 Overview/Usage/API Keys/Connect/API/Limits 多页签并新增 /dashboard/api/stats（严格按当前账号汇总）；Admin 改为账号禁用/启用与 Key 吊销；mcpAuth 增加账号禁用标记（Redis）避免缓存窗口 --- 修改了 src/index.ts src/admin.ts src/dashboard.ts src/mcpAuth.ts work.md
